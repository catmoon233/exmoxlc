{
  "_fv": 57,
  "_type": "procedure",
  "definition": {
    "procedurexml": "<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"Number\" id=\"jishu\">jishu</variable><variable type=\"MCItem\" id=\"armor\">armor</variable></variables><block type=\"event_trigger\" deletable=\"false\" x=\"40\" y=\"40\"><field name=\"trigger\">no_ext_trigger</field><next><block type=\"controls_if\"><value name=\"IF0\"><block type=\"item_istype\"><field name=\"item_type\">Armor</field><value name=\"item\"><block type=\"gui_get_item_inslot\"><value name=\"entity\"><block type=\"entity_from_deps\"></block></value><value name=\"slotid\"><block type=\"math_number\"><field name=\"NUM\">0</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><value name=\"IF0\"><block type=\"logic_negate\"><value name=\"BOOL\"><block type=\"math_binary_ops\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"item_nbt_num_get\"><value name=\"item\"><block type=\"gui_get_item_inslot\"><value name=\"entity\"><block type=\"entity_from_deps\"></block></value><value name=\"slotid\"><block type=\"math_number\"><field name=\"NUM\">0</field></block></value></block></value><value name=\"tagName\"><block type=\"text\"><field name=\"TEXT\">roll</field></block></value></block></value><value name=\"B\"><block type=\"math_number\"><field name=\"NUM\">1</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><value name=\"IF0\"><block type=\"math_binary_ops\"><field name=\"OP\">GTE</field><value name=\"A\"><block type=\"gui_get_amount_inslot\"><value name=\"entity\"><block type=\"entity_from_deps\"></block></value><value name=\"slotid\"><block type=\"math_number\"><field name=\"NUM\">1</field></block></value></block></value><value name=\"B\"><block type=\"variables_get_number\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" is_player_var=\"false\" has_entity=\"false\"></mutation><field name=\"VAR\">local:jishu</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><value name=\"IF0\"><block type=\"math_binary_ops\"><field name=\"OP\">GTE</field><value name=\"A\"><block type=\"gui_get_amount_inslot\"><value name=\"entity\"><block type=\"entity_from_deps\"></block></value><value name=\"slotid\"><block type=\"math_number\"><field name=\"NUM\">2</field></block></value></block></value><value name=\"B\"><block type=\"math_dual_ops\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><block type=\"variables_get_number\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" is_player_var=\"false\" has_entity=\"false\"></mutation><field name=\"VAR\">local:jishu</field></block></value><value name=\"B\"><block type=\"math_number\"><field name=\"NUM\">3</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"item_nbt_num_set\"><value name=\"item\"><block type=\"gui_get_item_inslot\"><value name=\"entity\"><block type=\"entity_from_deps\"></block></value><value name=\"slotid\"><block type=\"math_number\"><field name=\"NUM\">0</field></block></value></block></value><value name=\"tagName\"><block type=\"text\"><field name=\"TEXT\">roll</field></block></value><value name=\"tagValue\"><block type=\"math_number\"><field name=\"NUM\">1</field></block></value><next><block type=\"java_code\"><field name=\"CODE\">&amp;#10;        ItemStack armor = ItemStack.EMPTY;&amp;#10;        double armorvalue = 0;&amp;#10;        double armorvalue2 = 0;&amp;#10;        double weijie = 0;&amp;#10;        double suiji = 0;&amp;#10;&amp;#10;        // 确保玩家在GUI中并获取相关数据&amp;#10;        if (entity.containerMenu instanceof Supplier &amp;&amp; ((Supplier&lt;?&gt;) entity.containerMenu).get() instanceof Map) {&amp;#10;            Map&lt;Integer, Slot&gt; slots = (Map&lt;Integer, Slot&gt;) ((Supplier&lt;?&gt;) entity.containerMenu).get();&amp;#10;            Slot slot0 = slots.get(0);&amp;#10;            Slot slot1 = slots.get(1);&amp;#10;            Slot slot2 = slots.get(2);&amp;#10;&amp;#10;            if (slot0.getItem().getItem() instanceof ArmorItem &amp;&amp; &amp;#10;                    slot1.getItem().getCount() &gt;= jishu &amp;&amp;&amp;#10;                    slot2.getItem().getCount() &gt;= jishu * 3) {&amp;#10;&amp;#10;                armor = slot0.getItem().copy(); // 复制盔甲以避免修改原始物品堆叠&amp;#10;weijie = armor.getTag().getDouble(\"recasting\") * jishu;&amp;#10;                suiji = Mth.nextInt(RandomSource.create(), 60, 120) * 0.01;&amp;#10;&amp;#10;                EquipmentSlot equipmentSlot = ((ArmorItem)armor.getItem()).getEquipmentSlot();&amp;#10;                &amp;#10;                armorvalue = armor.getAttributeModifiers(equipmentSlot).get(Attributes.ARMOR).stream().mapToDouble(attributeModifier -&gt; attributeModifier.getAmount()).sum();&amp;#10;                armorvalue2 = armor.getAttributeModifiers(equipmentSlot).get(Attributes.ARMOR_TOUGHNESS).stream().mapToDouble(attributeModifier -&gt; attributeModifier.getAmount()).sum();&amp;#10;&amp;#10;                // 确保 weijie 和 suiji 已经被正确赋值&amp;#10;                double adjustedArmorValue = armorvalue * 0.1 * weijie * suiji;&amp;#10;                double adjustedToughnessValue = armorvalue2 * 0.1 * weijie * suiji;&amp;#10;&amp;#10;                UUID uuid_armor = UUID.fromString(\"687cc030-36a7-405d-bd34-0189b4a7db5e\");&amp;#10;                UUID uuid_toughness = UUID.fromString(\"687cc030-36a7-405d-bd34-0189b4a7db5f\");&amp;#10;&amp;#10;                if (armorvalue &gt; 0) {&amp;#10;                    armor.addAttributeModifier(Attributes.ARMOR, new AttributeModifier(uuid_armor, \"\\u62A4\\u7532\", adjustedArmorValue, AttributeModifier.Operation.ADDITION), equipmentSlot);&amp;#10;                }&amp;#10;                if (armorvalue2 &gt; 0) {&amp;#10;                    armor.addAttributeModifier(Attributes.ARMOR_TOUGHNESS, new AttributeModifier(uuid_toughness, \"\\u76D4\\u7532\\u4EFB\\u6027\", adjustedToughnessValue, AttributeModifier.Operation.ADDITION), equipmentSlot);&amp;#10;                }&amp;#10;&amp;#10;                // 更新物品堆叠及其属性&amp;#10;                slot1.remove((int) jishu);&amp;#10;                slot2.remove((int) (jishu * 3));&amp;#10;                slot0.set(armor); // 设置已更新属性的物品到槽位0&amp;#10;&amp;#10;                entity.containerMenu.broadcastChanges();&amp;#10;            }&amp;#10;        }</field></block></next></block></statement></block></statement></block></statement></block></statement></block></next></block><block type=\"add_item_modifier\" x=\"1004\" y=\"74\"><field name=\"attribute\">ARMOR</field><field name=\"slot\">HEAD</field><value name=\"modifier\"><block type=\"create_new_modifier\"><field name=\"operation\">ADDITION</field><value name=\"modifierid\"><block type=\"text\"><field name=\"TEXT\">687cc030-36a7-405d-bd34-0189b4a7db5d</field></block></value><value name=\"name\"><block type=\"text\"><field name=\"TEXT\">盔甲任性</field></block></value><value name=\"value\"><block type=\"variables_get_number\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" is_player_var=\"false\" has_entity=\"false\"></mutation><field name=\"VAR\">local:jishu</field></block></value></block></value><value name=\"item\"><block type=\"variables_get_itemstack\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" is_player_var=\"false\" has_entity=\"false\"></mutation><field name=\"VAR\"></field></block></value></block><block type=\"java_code\" x=\"1078\" y=\"260\"><field name=\"CODE\">if (armorvalue &gt; 0) {&amp;#10;    armor.addAttributeModifier(net.minecraft.world.entity.ai.attributes.Attributes.ARMOR,&amp;#10;            (new AttributeModifier(UUID.fromString(\"687cc030-36a7-405d-bd34-0189b4a7db5d\"), \"\\u62A4\\u7532\", armorvalue * 0.1 * weijie * suiji, AttributeModifier.Operation.ADDITION)), slot);&amp;#10;}&amp;#10;if (armorvalue2 &gt; 0) {&amp;#10;    armor.addAttributeModifier(net.minecraft.world.entity.ai.attributes.Attributes.ARMOR_TOUGHNESS,&amp;#10;            (new AttributeModifier(UUID.fromString(\"687cc030-36a7-405d-bd34-0189b4a7db6d\"), \"\\u76D4\\u7532\\u4EFB\\u6027\", armorvalue2 * 0.1 * weijie * suiji, AttributeModifier.Operation.ADDITION)), slot);&amp;#10;}&amp;#10;</field></block><block type=\"itemstack_to_mcitem\" x=\"-239\" y=\"369\"></block><block type=\"controls_if\" x=\"783\" y=\"405\"><value name=\"IF0\"><block type=\"math_binary_ops\"><field name=\"OP\">GT</field><value name=\"A\"><block type=\"variables_get_number\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" is_player_var=\"false\" has_entity=\"false\"></mutation><field name=\"VAR\">local:jishu</field></block></value><value name=\"B\"><block type=\"math_number\"><field name=\"NUM\">0</field></block></value></block></value></block><block type=\"controls_if\" x=\"877\" y=\"514\"><value name=\"IF0\"><block type=\"math_binary_ops\"><field name=\"OP\">GT</field><value name=\"A\"><block type=\"variables_get_number\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" is_player_var=\"false\" has_entity=\"false\"></mutation><field name=\"VAR\">local:jishu</field></block></value><value name=\"B\"><block type=\"math_number\"><field name=\"NUM\">0</field></block></value></block></value></block><block type=\"add_item_modifier\" x=\"911\" y=\"599\"><field name=\"attribute\">ARMOR</field><field name=\"slot\">HEAD</field><value name=\"modifier\"><block type=\"create_new_modifier\"><field name=\"operation\">ADDITION</field><value name=\"modifierid\"><block type=\"text\"><field name=\"TEXT\">687cc030-36a7-405d-bd34-0189b4a7db5d</field></block></value><value name=\"name\"><block type=\"text\"><field name=\"TEXT\">护甲</field></block></value><value name=\"value\"><block type=\"variables_get_number\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" is_player_var=\"false\" has_entity=\"false\"></mutation><field name=\"VAR\">local:jishu</field></block></value></block></value><value name=\"item\"><block type=\"variables_get_itemstack\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" is_player_var=\"false\" has_entity=\"false\"></mutation><field name=\"VAR\"></field></block></value></block><block type=\"variables_set_number\" x=\"795\" y=\"915\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" is_player_var=\"false\" has_entity=\"false\"></mutation><field name=\"VAR\">local:jishu</field><value name=\"VAL\"><block type=\"math_dual_ops\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><block type=\"item_nbt_num_get\"><value name=\"item\"><block type=\"gui_get_item_inslot\"><value name=\"entity\"><block type=\"entity_from_deps\"></block></value><value name=\"slotid\"><block type=\"math_number\"><field name=\"NUM\">0</field></block></value></block></value><value name=\"tagName\"><block type=\"text\"><field name=\"TEXT\">recasting</field></block></value></block></value><value name=\"B\"><block type=\"variables_get_number\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" is_player_var=\"false\" has_entity=\"false\"></mutation><field name=\"VAR\">local:jishu</field></block></value></block></value><next><block type=\"variables_set_number\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" is_player_var=\"false\" has_entity=\"false\"></mutation><field name=\"VAR\">local:jishu</field><value name=\"VAL\"><block type=\"math_dual_ops\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><block type=\"math_random_int_between\"><value name=\"min\"><block type=\"math_number\"><field name=\"NUM\">60</field></block></value><value name=\"max\"><block type=\"math_number\"><field name=\"NUM\">120</field></block></value></block></value><value name=\"B\"><block type=\"math_number\"><field name=\"NUM\">0.01</field></block></value></block></value><next><block type=\"java_code\"><field name=\"CODE\">UUID uuid_armor = UUID.fromString(\"687cc030-36a7-405d-bd34-0189b4a7db5e\");&amp;#10;UUID uuid_toughness = UUID.fromString(\"687cc030-36a7-405d-bd34-0189b4a7db5f\");&amp;#10;&amp;#10;EquipmentSlot slot = armor.getEquipmentSlot();&amp;#10;double armorvalue = armor.getAttributeModifiers(slot).get(Attributes.ARMOR).stream().mapToDouble(attributeModifier -&gt; attributeModifier.getAmount()).sum();&amp;#10;double armorvalue2 = armor.getAttributeModifiers(slot).get(Attributes.ARMOR_TOUGHNESS).stream().mapToDouble(attributeModifier -&gt; attributeModifier.getAmount()).sum();&amp;#10;&amp;#10;// 确保 weijie 和 suiji 已经被正确赋值&amp;#10;double adjustedArmorValue = armorvalue * 0.1 * weijie * suiji;&amp;#10;double adjustedToughnessValue = armorvalue2 * 0.1 * weijie * suiji;&amp;#10;&amp;#10;if (armorvalue &gt; 0) {&amp;#10;    armor.addAttributeModifier(Attributes.ARMOR,&amp;#10;            new AttributeModifier(uuid_armor, \"\\u62A4\\u7532\", adjustedArmorValue, AttributeModifier.Operation.ADDITION), slot);&amp;#10;}&amp;#10;&amp;#10;if (armorvalue2 &gt; 0) {&amp;#10;    armor.addAttributeModifier(Attributes.ARMOR_TOUGHNESS,&amp;#10;            new AttributeModifier(uuid_toughness, \"\\u76D4\\u7532\\u4EFB\\u6027\", adjustedToughnessValue, AttributeModifier.Operation.ADDITION), slot);&amp;#10;}</field><next><block type=\"gui_remove_items\"><value name=\"entity\"><block type=\"entity_from_deps\"></block></value><value name=\"slotid\"><block type=\"math_number\"><field name=\"NUM\">0</field></block></value><value name=\"amount\"><block type=\"math_number\"><field name=\"NUM\">1</field></block></value><next><block type=\"gui_set_items\"><value name=\"entity\"><block type=\"entity_from_deps\"></block></value><value name=\"slotid\"><block type=\"math_number\"><field name=\"NUM\">0</field></block></value><value name=\"amount\"><block type=\"math_number\"><field name=\"NUM\">1</field></block></value><value name=\"item\"><block type=\"variables_get_itemstack\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" is_player_var=\"false\" has_entity=\"false\"></mutation><field name=\"VAR\"></field></block></value><next><block type=\"gui_remove_items\"><value name=\"entity\"><block type=\"entity_from_deps\"></block></value><value name=\"slotid\"><block type=\"math_number\"><field name=\"NUM\">1</field></block></value><value name=\"amount\"><block type=\"variables_get_number\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" is_player_var=\"false\" has_entity=\"false\"></mutation><field name=\"VAR\">local:jishu</field></block></value><next><block type=\"gui_remove_items\"><value name=\"entity\"><block type=\"entity_from_deps\"></block></value><value name=\"slotid\"><block type=\"math_number\"><field name=\"NUM\">2</field></block></value><value name=\"amount\"><block type=\"math_dual_ops\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><block type=\"variables_get_number\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" is_player_var=\"false\" has_entity=\"false\"></mutation><field name=\"VAR\">local:jishu</field></block></value><value name=\"B\"><block type=\"math_number\"><field name=\"NUM\">3</field></block></value></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block><block type=\"text\" x=\"454\" y=\"1297\"><field name=\"TEXT\">tagName</field></block><block type=\"variables_set_itemstack\" x=\"223\" y=\"1395\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" is_player_var=\"false\" has_entity=\"false\"></mutation><field name=\"VAR\">local:armor</field></block></xml>"
  }
}